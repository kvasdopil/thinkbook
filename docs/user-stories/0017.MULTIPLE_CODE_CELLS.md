# 0017.multiple-code-cells

## Background

The notebook currently supports only one code cell, limiting how users structure and iterate on complex work. Multiple independent cells provide a familiar Jupyter-style workflow with better organization and reusability.

## User Story

> **As a** data-driven developer  
> **I want** to add, run, and remove multiple code cells in my notebook  
> **So that** I can organize complex scripts into logical chunks and rerun them efficiently.

## Acceptance Criteria

1. "Run All" button above cell list executes all cells sequentially top-to-bottom
2. "+ Add Cell" button inserts new empty code cell at list end
3. Single AI chat interface at page top (after title, before controls) for all cells
4. Each cell has Monaco editor, isolated output area, and status/run/stop button
5. Output cleared immediately when cell execution begins
6. Delete button (`FaTrash` icon) removes cell after user confirmation
7. Running cells are not editable; "Run All" disabled when any cell running
8. Proper execution states: COMPLETE (green), CANCELLED (orange), FAILED (red)
9. Cell-specific output only (no system messages in output areas)
10. Real-time output appears as generated during execution

## Technical Notes

- **State Management**: Use refs for execution tracking to avoid React closure issues
- **Output Isolation**: Each cell displays only its own stdout/stderr
- **AI Integration**: Single chat with `listCells` and `updateCell` functions for all cells
- **Execution States**: Strict enforcement of complete/cancelled/failed states based on worker messages
- **Accessibility**: WCAG 2.1 AA compliance for keyboard focus and screen readers

## Out of Scope

- Cell reordering via drag-and-drop
- Persisting cell list to backend or localStorage

## Potential Pitfalls

- **React closures**: Worker message handlers capturing stale state values
- **State confusion**: Cells ending in wrong execution state
- **System message leakage**: Internal messages appearing in user output
- **Chat duplication**: Rendering chat per cell instead of once at page level
- **Output flashing**: Previous output briefly visible before clearing

## Definition of Done

- All acceptance criteria are met
- Unit / integration tests pass
- Lint & type-check succeed
- Manual testing confirms execution states and output isolation
- Single AI chat interface works with all cells
- Cells belong to same pyodide instance, if 1st cell contains `testvar = 123` then 2nd cell should be able to `print(testvar)`, etc.
