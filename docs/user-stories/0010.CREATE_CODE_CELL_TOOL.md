# 0010.create-code-cell-tool

## Background

AI assistance in the notebook currently manipulates existing code cells but cannot create new ones. Allowing the AI to programmatically add a cell keeps the conversation flow natural, eliminates manual steps for users, and ensures new examples or fixes appear exactly where they are most relevant.

## User Story

> **As a** notebook user
> **I want** the AI assistant to be able to create new code cells via a dedicated `createCodeCell` tool
> **So that** code snippets and examples appear seamlessly in the conversation without manual intervention

## Acceptance Criteria

1. A new AI tool `createCodeCell` is available to the AI function-calling interface.
2. The tool accepts a single required parameter `text` (string) containing the full source code for the cell.
3. The tool returns `{ success: true }` upon successful creation.
4. When invoked, a new code cell is inserted **immediately after** the chat message that triggered the tool call, maintaining chronological order.
5. The newly created cell starts in a **collapsed** state; its code editor is hidden by default.
6. While collapsed, the cell displays a description derived from the first top-level comment in the code (same extraction logic as existing cells).
7. AI agents are instructed (via system prompt or docs) to **always** include a descriptive top-level comment when creating or editing cells so that meaningful descriptions are available.
8. All existing cell controls (run/stop, toggle visibility, delete) function correctly with newly created cells.
9. Unit and integration tests cover successful creation, ordering, collapsed display, and description extraction.

## Technical Notes

- Implement the tool similarly to `listCells` and `updateCell`, exporting a Zod-validated schema.
- Extend the conversation reducer to handle the new item insertion logic.
- Reuse existing collapse/description logic from `Cell` component.
- Update system prompt to remind AI about mandatory description comments.
- Missing or non-comment first line could result in an empty description, display a placeholder if a code has no description.

## Out of Scope

- Bulk creation of multiple cells in a single call.
- Reordering of existing cells.

## Definition of Done

- All acceptance criteria are met
- Unit / integration tests pass
- Lint & type-check succeed
- Documentation (README, Storybook, etc.) is updated
