# 0007.ai-function-calls

## Background

The AI chat assistant needs structured ways to interact with notebook cells beyond natural language. Function calls provide deterministic, auditable actions for reading and modifying code cells.

## User Story

> **As a** user chatting with the AI assistant  
> **I want** the AI to directly read and modify my notebook cells  
> **So that** I can get help without manual copy-pasting of code.

## Acceptance Criteria

1. AI can call `listCells()` to get snapshot of all cells with ID, type, text, and output
2. AI can call `updateCell(id, text)` to replace cell contents
3. Function calls render as conversation balloons with status-colored backgrounds
4. Status indicators: blue (in-progress), green (success), red (failure), orange (cancelled)
5. Each function lives in separate file under `app/ai-functions/` folder
6. Functions use Zod schemas for parameter validation (required by Vercel AI SDK)
7. Frontend imports and implements functions; backend exports metadata only
8. Function calls appear exactly once using `message.toolInvocations`

## Technical Notes

- **Schema Definition**: Zod schemas exported as `parameters: zodSchema`
- **Function Structure**: Metadata on server, implementation on frontend
- **State Management**: Store calls in `Record<string, AIFunctionCall>` by `toolCallId`
- **API Integration**: Pass Zod schemas to `tools` parameter in `streamText`
- **Validation**: Use `zodSchema.parse()` before execution
- **Initial Functions**: `listCells()` and `updateCell(id, text)` for MVP

## Out of Scope

- Cancel button for function calls
- Parallel function execution (sequential only)

## Potential Pitfalls

- **Schema mismatch**: Must use Zod schemas, not JSON schemas
- **Duplication**: Use `message.toolInvocations` to prevent duplicate rendering
- **State management**: Store by `toolCallId` to avoid conflicts
- **Parameter validation**: Always validate with Zod before execution

## Definition of Done

- All acceptance criteria are met
- Unit tests for function implementations
- Lint & type-check succeed
- Function calls work with correct status indicators
- No duplication in conversation balloons
