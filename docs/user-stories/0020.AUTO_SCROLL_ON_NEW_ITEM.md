# 0020.auto-scroll-on-new-item

## Background

In a chat-centric notebook, new messages and freshly created code cells often appear beyond the current viewport. Manually scrolling every time interrupts the user’s flow and wastes time. Automating the scroll only when brand-new items arrive keeps the user focused on the most recent context without unexpected jumps during edits or execution updates.

## User Story

> **As a** data scientist
> **I want** the notebook interface to automatically scroll to the newest message or code cell when it is added
> **So that** I can immediately view the latest content without manual scrolling.

## Acceptance Criteria

1. When a new chat message is appended to the unified conversation list, the viewport scrolls to the bottom, revealing the new item.
2. When a new code cell is created (by the user or via an AI tool call), the viewport scrolls to the bottom, revealing the new cell.
3. Auto-scroll **does not** trigger when an existing cell is:
   - modified (text edit),
   - running or its output updates,
   - deleted.
4. Scrolling is smooth (animation ≤ 300 ms) and respects the user’s **reduced-motion** preference (`prefers-reduced-motion`).
5. Behaviour works consistently on desktop and mobile viewports (≥ 320 px width) without layout shifts.
6. Unit tests cover: (a) new message scroll, (b) new cell scroll, (c) cell modification without scroll, (d) cell execution updates without scroll, (e) cell deletion without scroll.

## Technical Notes (optional)

- Detect additions by comparing the `conversationItems.length` in a `useEffect` hook.
- Use `ref` on the final list item and `Element.scrollIntoView({ behavior: 'smooth' })` when criteria met.
- Guard against auto-scroll if the user has manually scrolled up (e.g., if `scrollTop + clientHeight + 100 < scrollHeight`).
- Provide instant scroll (`behavior: 'auto'`) when reduced-motion is preferred.
- Mock `scrollIntoView` in tests using Jest and `@testing-library/react`.

## Definition of Done

- All acceptance criteria are met.
- Unit and integration tests pass.
- ESLint, Prettier, and TypeScript checks succeed.
- README’s _Implemented user-stories_ section is updated with a summary of this story.
