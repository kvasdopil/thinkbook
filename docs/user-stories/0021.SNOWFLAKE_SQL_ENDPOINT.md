# 0021.snowflake-sql-endpoint

## Background

Internal tools need seamless access to Snowflake data from the browser. A frontend service allows the frontend (and AI agents) to run parameterised SQL queries or paginate existing result sets by making direct calls to Snowflake's REST API.

## User Story

> **As a** frontend developer or AI agent
> **I want** a frontend service that can execute SQL or fetch existing Snowflake result partitions
> **So that** I can retrieve data from Snowflake on demand using direct API calls.

## Acceptance Criteria

1. A frontend service class `SnowflakeService` exists under `src/services/snowflake.ts`.
2. When called with `{ "sql": "SELECT …" }` the service forwards the query to Snowflake's REST API and returns the full JSON response.
3. When called with `{ "handle": "<id>", "partition": <number?> }` the service fetches the specified partition of a previously-executed statement and returns the JSON response.
4. The service uses Snowflake access token from user settings/localStorage; if absent it throws an error `"A valid Snowflake access token is required"`.
5. Missing both `sql` and `handle` fields results in an error `'Request must contain either "sql" or "handle"'`.
6. Errors from the Snowflake API are propagated with descriptive error messages.
7. The service reads the base URL from user settings/localStorage for the Snowflake hostname.
8. TypeScript types for Snowflake responses are defined (`interface SnowflakeResult { … }`).
9. Unit tests cover successful SQL execution, partition fetch, missing token, missing parameters, and Snowflake error propagation.
10. All existing lint, type-check, and test suites pass.

## Technical Notes

- Query with appropriate headers (`Authorization: Bearer <token>`).
- Snowflake statement timeout set to 30 seconds (`timeout: 30`).
- Convert `partition` to number with fallback to `0`.
- Handle CORS issues by making direct requests to Snowflake's REST API.
- Log client-side errors via `console.error` for debugging.

## Out of Scope (optional)

- UI components for composing SQL queries.
- Token acquisition/refresh logic (handled elsewhere).
- Streaming results or chunked transfer encoding.
- Backend API endpoints

## Definition of Done

- All acceptance criteria are met.
- Unit / integration tests pass.
- Lint & type-check succeed.
- README updated under “Implemented user-stories”.
