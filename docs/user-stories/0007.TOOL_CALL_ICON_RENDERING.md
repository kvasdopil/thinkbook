# 0007.tool_call_icon_rendering

## Background

AI tool calls currently appear as verbose blocks within the conversation, making it hard to scan the flow of messages. Representing tool calls as concise status icons will improve readability while still allowing access to detailed information on demand.

## User Story

> **As a** notebook user
> **I want** tool calls rendered as status icons with hover and click interactions
> **So that** I can quickly understand the outcome of AI function executions and inspect details only when needed

## Acceptance Criteria

1. Each tool call is rendered as a single compact icon representing the tool (e.g., database for `listCells`, edit for `updateCell`). Status is conveyed by icon color:
   - In-progress → blue text color
   - Success → gray text color
   - Failure → red text color
   - Cancelled → orange text color
2. Multiple tool calls contained in the same message appear inline, separated by ~8 px of horizontal space (e.g., Tailwind `gap-2`).
3. Tooltips are optional. If present, hovering an icon shows a tooltip containing the tool name and status.
4. Clicking the icon toggles a collapsible details panel directly beneath the message that reveals structured information:
   - Function name
   - Request arguments (JSON, only if present)
   - Result or error (JSON)
   - Tool call ID
5. Icons and panels are keyboard-accessible using a native `button` element (TAB focus, Enter/Space activate) and should meet contrast guidelines for the chosen theme.
6. Unit tests verify icon rendering based on tool name and status color, click toggling behavior, inline layout for multiple tool calls, and rendering order. Tooltip tests are only required if tooltips are implemented.
7. Existing integration tests for conversation rendering pass without modification.
8. Tool call icons are rendered in the same order they appear in `message.parts`, and appear before any assistant text in the same message.

## Technical Notes

- Use `react-icons/fa` for tool icons and Tailwind CSS utility classes for colors/spacing.
- Use a `button` wrapper around the icon to toggle expansion and to provide keyboard accessibility.
- The details panel can use a subtle background (e.g., `bg-gray-900`) and monospace formatting with `<pre>` for JSON; borders are optional.
- Render tool call parts from `message.parts` using AI SDK helpers (`isToolOrDynamicToolUIPart`, `getToolOrDynamicToolName`). Render tool parts before assistant text in the same message.
- Determine status from part state: `output-available` → success; otherwise show in-progress; map error/cancelled states when available.
- Guard JSON rendering with try/catch around `JSON.stringify` and handle string results directly.
- Ensure the component does not duplicate tool call content into the plain text area.

## Out of Scope

- Custom SVG animations beyond the simple spinner.
- Persisting expanded/collapsed state across sessions.

## Potential Pitfalls (optional)

- Overlapping z-index causing tooltips to be hidden behind other elements.
- Large JSON payloads affecting performance—consider lazy-loading or code-block virtualization.

## Definition of Done

- All acceptance criteria are met.
- Unit / integration tests pass.
- Lint & type-check succeed.
- README updated under "Implemented user-stories" when feature is complete.
