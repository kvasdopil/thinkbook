# 0003.streaming-output

## Background

Current Python execution displays output only after script completion, creating poor UX for long-running scripts. Users need real-time output to see progress and intermediate results.

## User Story

> **As a** user running Python scripts  
> **I want** to see output appear in real-time as it's generated  
> **So that** I can monitor progress of long-running scripts and see intermediate results.

## Acceptance Criteria

1. Each `print()` statement displays output immediately, not after script completion
2. Output appears progressively for scripts with delays (e.g., `time.sleep()`)
3. Streaming works with existing Pyodide web worker architecture
4. Error handling continues to work properly during streaming
5. Run button remains disabled during execution to prevent multiple runs

## Technical Notes

- **Message Types**: `{ type: "out" | "err", value: string }` for flexible rendering
- **Worker Communication**: Post messages immediately after each `print()` or `display()` call
- **Python Integration**: Use JavaScript callbacks via `pyodide.globals.set()` instead of direct `js.postMessage()`
- **Output Buffering**: No maximum log size (append indefinitely)
- dont forget to add comprehensive tests

## Potential Pitfalls

- **DataCloneError**: Don't use `js.postMessage()` directly from Python; use JavaScript callbacks
- **Keyword conflicts**: When redefining `print()`, copy kwargs and set file parameter explicitly
- **Infinite recursion**: Only call `original_print` once in custom print function
- **Message synchronization**: Use shared types file for consistent worker/main thread communication
- **Function restoration**: Always restore original `print` and `sys.stderr` in `finally` block

## Definition of Done

- All acceptance criteria are met
- Unit / integration tests pass
- Lint & type-check succeed
- Real-time output works for scripts with delays
- Error handling preserved during streaming execution
