# 0002.jupyter-engine

## Background

The app needs a Python execution environment in the browser to run code cells. Pyodide provides Python runtime via WebAssembly, while Monaco Editor handles syntax highlighting and editing.

## User Story

> **As a** user  
> **I want** to write Python code in a syntax-highlighted editor and execute it  
> **So that** I can run Python scripts and see their output in my browser.

## Acceptance Criteria

1. A textarea with Python syntax highlighting is displayed on the main page
2. A "Run" button executes the Python code using Pyodide in a web worker
3. Code output (print statements, errors) appears below the editor
4. Editor uses Monaco Editor with proper Python language support
5. Pyodide loads from CDN (https://cdn.jsdelivr.net/npm/pyodide@0.28.0/)
6. Python execution is isolated in a web worker for performance

## Technical Notes

- **Editor**: Monaco Editor for syntax highlighting and code editing
- **Python Runtime**: Pyodide 0.28.0 loaded from CDN
- **Architecture**: Web Worker isolates Python execution from main thread
- **Output**: Plain-text stdout/stderr only (rich display out of scope)
- **Packages**: Default Pyodide packages only (no additional wheels)
- **Worker Bundling**: Use Next.js bundling via `new Worker(new URL('./worker.ts', import.meta.url))`

## Potential Pitfalls

- **Function naming conflicts**: Don't name worker functions same as imported library globals (e.g., avoid `loadPyodide()` when importing Pyodide)
- **Code injection safety**: Use `pyodide.globals.set()` and `exec()` instead of template literals to prevent JavaScript parsing errors
- **TypeScript setup**: Include `/// <reference lib="webworker" />` and `DedicatedWorkerGlobalScope` type
- **CDN consistency**: Ensure `indexURL` matches the CDN version used in `importScripts()`
- **React Strict Mode**: Multiple worker initialization attempts in development are expected behavior

## Definition of Done

- All acceptance criteria are met
- Unit / integration tests pass
- Lint & type-check succeed
- Python code executes successfully in web worker
- Output displays correctly below editor
